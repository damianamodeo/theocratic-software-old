import{r as h,u as D,j as e,B as O}from"./index-10cb662a.js";import{M as w,B as b,T as E}from"./Modal-a63495ca.js";import{r as y,f as j,b as S,d as L,c as A}from"./deleteNotAtHome-63823a81.js";import{F as g}from"./Form-a54bd75d.js";import{C as N}from"./Center-72074b78.js";import{L as M}from"./Longpress-4b81486b.js";import"./transition-9d77fc70.js";import"./upDownArrow-e918741e.js";const $=async({cong:n,mapID:t,suburb:s,street:c,coordinates:i})=>{const o=y(j,n,"maps");try{return await S(j,async r=>{if(!(await r.get(o)).exists())return{};const u=await r.get(o).then(m=>{var p;return(p=m.data())==null?void 0:p.mapDetails});return u[t].suburbs[s].streets.includes(c)||(u[t].suburbs[s].streets=[...u[t].suburbs[s].streets,{name:c,lng:i.lng,lat:i.lat}].sort((m,p)=>m.name.toLowerCase().localeCompare(p.name.toLowerCase()))),r.update(o,{mapDetails:u}),console.log(`<<< NEW STREET ADDED >>>
`,c,`
Latest mapDetails:`,u),u})}catch(a){return console.error(a.message),a}},_=async(n,t,s,c)=>{t==null||t.toString();const i=`https://api.mapbox.com/geocoding/v5/mapbox.places/${n}.json?country=au&bbox=${t==null?void 0:t.join("%2C")}&proximity=151.209889%2C-33.874666&types=address&fuzzyMatch=false&access_token=pk.eyJ1IjoiZGFtaWFuYW1vZGVvIiwiYSI6ImNqeWxnb3lsejA4OXozYmxpajhzMXdvZjQifQ.OJBOK5ZvGEX2VaScbW_zUQ`;return await fetch(i).then(o=>o.json()).then(o=>o.features)},W=({isOpen:n,closeModal:t,map:s,suburb:c,mapDetails:i})=>{const[o,a]=h.useState({street:"",lng:0,lat:0}),[r,d]=h.useState([]),u=async l=>{if(l.target.value.length<=2){d([]);return}a({street:l.target.value,lng:0,lat:0});const f=await _(o.street,i[s].suburbs[c].bbox,i[s].suburbs[c].name);f&&d(f)},m=()=>{$({cong:"australia_nsw_maitland",mapID:s,suburb:c,street:o.street,coordinates:{lng:o.lng,lat:o.lat}}),t({type:"street",payload:o.street}),a({street:"",lng:0,lat:0}),d([])},p=()=>{t({type:"street",payload:"init"}),a({street:"",lng:0,lat:0})};return D(()=>{t({type:"street",payload:"init"}),a({street:"",lng:0,lat:0})}),e.jsx(w,{isOpen:n,onClose:()=>{},title:"Add Street",height:"lg",children:e.jsx("div",{className:"h-full relative",children:e.jsx(g,{children:e.jsxs("div",{className:"flex justify-evenly m-4",children:[e.jsx(g.Autocomplete,{value:o.street,onChange:l=>{u(l)},onSelect:l=>{console.log(l.props.children[0].props.id),a({street:l.props.children[0].props.children,lng:l.props.children[0].props.id[0],lat:l.props.children[0].props.id[1]})},options:r.map((l,f)=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold",id:l.center,children:l.text}),e.jsx("div",{className:"text-xs",children:l.place_name.split(", ")[1]})]})),width:"lg"}),e.jsxs("div",{className:"flex gap-2 m-auto absolute bottom-0 justify-evenly w-full",children:[e.jsx(b,{color:"blue",clickAction:p,width:"sm",children:"Cancel"}),r.map(l=>l.text).includes(o.street)&&e.jsx(b,{color:"blue",clickAction:m,width:"sm",children:"Add"})]})]})})})})},F=async({cong:n,mapID:t,suburb:s,bbox:c})=>{const i=y(j,n,"maps");try{const o=await S(j,async a=>{if(!(await a.get(i)).exists())return console.log("<<<NO SUCH DOCUMENT>>>"),{};const d=await a.get(i).then(u=>{var m;return(m=u.data())==null?void 0:m.mapDetails});return d[t].suburbs=[...d[t].suburbs,d[t].suburbs.map(({name:u})=>(console.log(u),u)).includes(s)?null:{streets:[],bbox:c,name:s}].sort((u,m)=>u.name.toLowerCase().localeCompare(m.name.toLowerCase())),a.update(i,{mapDetails:d}),d});return console.log(`<<< NEW SUBURB ADDED >>>
`,s,`
Latest mapDetails:`,o),o}catch(o){return console.error(o.message),o}},B=async(n,t,s)=>await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${n}.json?types=place&proximity=151.209889,-33.874666&access_token=pk.eyJ1IjoiZGFtaWFuYW1vZGVvIiwiYSI6ImNqeWxnb3lsejA4OXozYmxpajhzMXdvZjQifQ.OJBOK5ZvGEX2VaScbW_zUQ`).then(i=>i.json()).then(i=>i.features),R=({isOpen:n,closeModal:t,map:s})=>{const[c,i]=h.useState(""),[o,a]=h.useState([]),[r,d]=h.useState([]),[u,m]=h.useState([]),p=async x=>{if(i(x.target.value),x.target.value.length<=2){d([]);return}const k=await B(x.target.value);m(k.map((v,I)=>({display:e.jsxs("div",{className:`${I} font-semibold`,children:[v.text,e.jsx("div",{className:"text-sm font-light dark:text-neutral-200",children:v.place_name})]}),...v})))},l=x=>{a(u[x.props.className[0]].bbox),i(x.props.children[0])},f=()=>{F({cong:"australia_nsw_maitland",mapID:s,suburb:c,bbox:o}),t({type:"suburb",payload:c}),i(""),d([])},C=()=>{t({type:"suburb",payload:"init"}),i("")};return h.useEffect(()=>(d(u.map(x=>x.display)),()=>{}),[u]),e.jsx(w,{isOpen:n,onClose:()=>{},title:"Add Suburb",height:"lg",children:e.jsx("div",{className:"h-full relative",children:e.jsx(g,{children:e.jsxs("div",{className:"flex justify-around m-4",children:[e.jsx(g.Autocomplete,{value:c,onChange:x=>p(x),onSelect:l,options:r,width:"lg"}),e.jsxs("div",{className:"flex gap-2 m-auto-xx absolute bottom-0 justify-evenly w-fit",children:[e.jsx(b,{color:"blue",clickAction:C,width:"sm",children:"Cancel"}),r.map(x=>x.props.children[0]).includes(c)&&e.jsx(b,{color:"blue",clickAction:f,width:"sm",children:"Add"})]})]})})})})},z=async({houseNumber:n,street:t,suburb:s,bbox:c,country:i})=>{const a=`https://api.mapbox.com/geocoding/v5/mapbox.places/${n}%20${t}%20${s}%20.json?country=au&bbox=${c[0]-.015}%2C${c[1]-.015}%2C${c[2]+.015}%2C${c[3]+.015}&types=address&fuzzyMatch=false&access_token=pk.eyJ1IjoiZGFtaWFuYW1vZGVvIiwiYSI6ImNqeWxnb3lsejA4OXozYmxpajhzMXdvZjQifQ.OJBOK5ZvGEX2VaScbW_zUQ`;return await fetch(a).then(r=>r.json()).then(r=>({lng:r.features[0].center[0],lat:r.features[0].center[1],relevance:r.features[0].relevance}))},Q=async({cong:n,mapID:t,lng:s,lat:c,relevance:i,streetCoordinates:o,...a})=>{const r={["id"+Date.now()]:{user:`${localStorage.getItem("initID")}_${localStorage.getItem("username")}`,id:Date.now(),mapNumber:t,relevance:i,...a,...i>.7037?{lng:s,lat:c}:o}},d=y(j,"notAtHomes","MaitlandCongregation");try{const u=await S(j,async m=>{const p="id"+Date.now();return(await m.get(d)).exists()?(m.update(d,r),r):(m.set(d,r),"First Not At Home created successfully")});return console.log(`<<< NEW NOT AT HOME ADDED >>>
Address Details:`,u),u}catch(u){return console.error(u.message),u}},Z=({closeModal:n,address:t,streetCoordinates:s,bbox:c,dispatch:i})=>{const[o,a]=h.useState({lng:0,lat:0,relevance:-1}),[r,d]=h.useState(!1),u=async()=>{const p=await z({...t,bbox:c});a(p)},m=async p=>{await Q({...o,...t,calls:[Date.now()],cong:"australia_nsw_maitland",streetCoordinates:s,letter:p}),t.unitNumber===""&&i({type:"houseNumber",payload:""}),i({type:"unitNumber",payload:""}),n(!1)};return h.useEffect(()=>{u()},[]),e.jsx(w,{isOpen:!0,onClose:()=>{},title:"",height:"lg",children:e.jsx(N,{children:e.jsx("div",{className:"h-full relative text-white",children:e.jsx(g,{children:e.jsxs("div",{className:"text-center text-lg font-bold m-1 pt-2 h-full",children:[e.jsxs("div",{className:"text-center m-4",children:[t.unitNumber,t.unitNumber?"/":"",t.houseNumber," ",t.street,", ",t.suburb]}),o.relevance<0?e.jsx("div",{children:"Loading"}):o.relevance<1?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-orange-500",children:["WARNING!!!",e.jsx("p",{className:"mx-10 text-center text-base font-light",children:"Exact coordinates were not found for this address. Are you sure you want to submit?"})]}),e.jsx("div",{className:"grid place-items-center gap-2 mt-10",children:r?e.jsxs(e.Fragment,{children:[e.jsx(b,{color:"blue",width:"md",clickAction:()=>n(!1),children:"cancel"}),e.jsx(b,{color:"blue",width:"md",clickAction:()=>m(!0),children:"Letter List"}),e.jsx(b,{color:"blue",width:"md",clickAction:()=>m(!1),children:"Return List"})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{color:"blue",width:"md",clickAction:()=>n(!1),children:"No"}),e.jsx(b,{color:"blue",width:"md",clickAction:()=>d(!0),children:"Yes"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-green-500 text-base font-normal",children:["SUCCESS!!!",e.jsx("p",{children:"Exact match found."})]}),e.jsxs(N,{style:"gap-5 mt-4",children:[e.jsx(b,{color:"blue",width:"md",clickAction:()=>n(!1),children:"cancel"}),e.jsx(b,{color:"blue",width:"md",clickAction:()=>m(!0),children:"Letter List"}),e.jsx(b,{color:"blue",width:"md",clickAction:()=>m(!1),children:"Return List"})]})]})]})})})})})},H=(n,t)=>typeof t.payload=="object"?{...n,[t.type]:"adding "+t.type}:{mapID:{mapID:t.payload,suburb:"init",street:"init",houseNumber:"",unitNumber:""},suburb:{...n,suburb:t.payload,street:"init",houseNumber:"",unitNumber:""},street:{...n,street:t.payload,houseNumber:"",unitNumber:""},houseNumber:{...n,houseNumber:t.payload},unitNumber:{...n,unitNumber:t.payload}}[t.type],Y=({mapDetails:n,changeSubpage:t})=>{const[s,c]=h.useReducer(H,{mapID:"init",suburb:"init",street:"init",houseNumber:"",unitNumber:"",mapData:{}}),[i,o]=h.useState(!1),{setBackButtonAction:a}=h.useContext(O),r=()=>Math.max(0,n.findIndex(l=>l.id==s.mapID)),d=()=>s.mapID==="init"?0:Math.max(0,n[r()].suburbs.findIndex(l=>l.name===s.suburb)),u=()=>n[r()].suburbs[d()].streets.findIndex(l=>l.name===s.street),m=n.length===0?[]:n[r()].suburbs.map(l=>l.name),p=n.length===0?[]:n[r()].suburbs.length===0?[]:n[r()].suburbs[d()].streets.map(l=>l.name);return h.useEffect(()=>(a(()=>()=>t("Home",">")),()=>{}),[]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex justify-center p-2 w-full",children:[e.jsxs(g,{children:[e.jsx(g.Select,{onChange:l=>{c({type:"mapID",payload:l})},options:n.map(l=>l.id),placeholder:"Map",value:s.mapID,width:"full",height:"md"}),e.jsx("div",{className:"h-2"}),s.mapID!=="init"&&e.jsx(g.Select,{onChange:l=>{c({type:"suburb",payload:l})},value:s.suburb,options:[...m,e.jsx("span",{className:"text-blue-400",children:"add new suburb"})],placeholder:"Suburb",width:"full",height:"md"}),e.jsx("div",{className:"h-2"}),s.suburb==="init"?null:e.jsx(g.Select,{onChange:l=>{c({type:"street",payload:l})},value:s.street,options:[...p,e.jsx("span",{className:"text-blue-400",children:"add new street"})],placeholder:"Street",width:"full",height:"md"}),e.jsx("div",{className:"h-2"}),e.jsxs("div",{className:"flex",children:[s.houseNumber===""?null:e.jsx(e.Fragment,{children:e.jsx(g.Alphanumeric,{value:s.unitNumber,label:"",placeholder:"Unit",onChange:l=>c({type:"unitNumber",payload:l}),width:"sm",height:"md"})}),e.jsx("div",{className:"grow"}),s.street==="init"?null:e.jsx(g.Alphanumeric,{value:s.houseNumber,label:"",placeholder:"House",onChange:l=>c({type:"houseNumber",payload:l}),width:"sm",height:"md"})]}),e.jsx("div",{className:"h-8"}),e.jsx("div",{className:"grid gap-4",children:s.houseNumber===""?null:e.jsx(N,{children:e.jsx(b,{clickAction:()=>o(!0),width:"md",height:"md",color:"blue",children:"Add"})})})]}),e.jsx(R,{isOpen:s.suburb==="adding suburb",closeModal:c,map:r()}),e.jsx(W,{isOpen:s.street==="adding street",closeModal:c,map:r(),suburb:d(),mapDetails:n}),i&&e.jsx(Z,{closeModal:o,address:s,bbox:n[r()].suburbs[d()].bbox,streetCoordinates:{lng:n[r()].suburbs[d()].streets[u()].lng,lat:n[r()].suburbs[d()].streets[u()].lat},dispatch:c})]})})},G=({isOpen:n,address:t,setUpdateModelOpen:s})=>e.jsxs(w,{onClose:()=>{},title:"",isOpen:n,height:"md",children:[e.jsxs("div",{className:"h-full text-center text-lg dark:text-white",children:["Would you like to delete",e.jsxs("p",{className:"font-bold text-xl py-2",children:[t.unitNumber&&`${t.unitNumber}/`,t.houseNumber," ",t.street,", ",t.suburb,"?"]})]}),e.jsx(N,{children:e.jsxs("div",{className:"grid gap-8",children:[e.jsx(b,{width:"md",clickAction:()=>{s(!1)},color:"red",children:"NO"}),e.jsx(b,{width:"md",clickAction:()=>{L(t),s(!1)},color:"green",children:"YES"})]})})]}),X=({notAtHomesList:n})=>{const[t,s]=h.useState(!1),[c,i]=h.useState({}),o=a=>{i(a),s(!0)};return e.jsxs("div",{className:"pb-16",children:[e.jsx("div",{className:"text-sm text-center m-2 text-blue-500 dark:text-blue-300"}),n&&n.sort((a,r)=>r.key.localeCompare(a.key)).filter(a=>a.user===`${localStorage.getItem("initID")}_${localStorage.getItem("username")}`).map((a,r)=>e.jsx("div",{children:e.jsxs("div",{className:"flex rounded m-2 p-2 dark:bg-neutral-700 bg-neutral-200 text-xs",children:[e.jsxs("div",{className:"dark:text-white",children:[e.jsxs("div",{className:"font-bold",children:["Map: ",a.mapNumber," - ",a.suburb," - ",a.letter?e.jsx("span",{className:"text-blue-500 dark:text-blue-400",children:"Letter List"}):e.jsx("span",{className:"text-green-500 dark:text-green-400",children:"Return List"})]}),e.jsx("div",{className:"text-lg",children:`${a.unitNumber&&`${a.unitNumber}/`}${a.houseNumber} ${a.street}`})]}),e.jsx("div",{className:"grow"}),e.jsx(M,{style:"w-10 grid place-items-center",action:()=>o(a),children:e.jsx("div",{children:e.jsx("div",{className:"bg-red-500 font-bold h-4 w-4 text-xs rounded-full text-center",children:"X"})})})]})},r)),t&&e.jsx(G,{isOpen:t,address:c,setUpdateModelOpen:s})]})},te=({changeSubpage:n})=>{const[t,s]=h.useState([]),[c,i]=h.useState([{key:""}]);return h.useEffect(()=>A(y(j,"notAtHomes","MaitlandCongregation"),a=>{const r=a.data(),d=r?Object.keys(r).map(u=>({key:u,...r[u]})):[];i(d)}),[]),h.useEffect(()=>{const o=A(y(j,"australia_nsw_maitland","maps"),a=>{var r;a.data()&&s((r=a.data())==null?void 0:r.mapDetails)});return()=>{o()}},[]),e.jsx("div",{className:"h-full",children:e.jsx(E,{color:"blue",tabItems:[{title:"Add",content:e.jsx(Y,{mapDetails:t,changeSubpage:n})},{title:"List",content:e.jsx(X,{notAtHomesList:c})}]})})};export{te as default};
